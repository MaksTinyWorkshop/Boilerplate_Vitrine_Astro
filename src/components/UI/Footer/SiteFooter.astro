---
import ActionButton from "@components/CTAs/ActionButton/ActionButton.astro";
import { siteConfig } from "@lib/siteData";
import { resolveUrl } from "@lib/urlHelpers";
import styles from "./footer.module.scss";
import Spacer from "../Spacer.astro";

const year = new Date().getFullYear();

const secondaryLogo = siteConfig.brand.logos[1];
const secondaryLogoSrc = secondaryLogo
  ? resolveUrl(secondaryLogo.src)
  : "";
const primaryAction = siteConfig.contact.primaryAction;
const companyName = siteConfig.legal.companyName || siteConfig.brand.name;
const footerLinks = [
  ...siteConfig.navigation.footer,
  ...siteConfig.legal.links,
].filter(
  (link, index, array) =>
    array.findIndex((candidate) => candidate.href === link.href) === index
);
---

<footer class={styles.footer}>
  <div class={styles.logo} aria-hidden="true">
    {
      secondaryLogoSrc && (
        <img
          src={secondaryLogoSrc}
          alt={secondaryLogo?.alt ?? "Logo secondaire"}
          loading="lazy"
        />
      )
    }
  </div>

  {
    primaryAction && (
      <ActionButton
        label={primaryAction.label}
        href={resolveUrl(primaryAction.href)}
        icon={primaryAction.icon}
      />
    )
  }

  {
    footerLinks.length > 0 && (
      <div class={styles.cgv_legals}>
        {footerLinks.map((link, index) => (
          <span class={styles.linkWrapper}>
            <a class={styles.link} href={resolveUrl(link.href)}>
              {link.label}
            </a>
            {index < footerLinks.length - 1 && (
              <Spacer size="1rem" axis="horizontal" />
            )}
          </span>
        ))}
      </div>
    )
  }
  <p class={styles.copyright}>
    © {year} {companyName}. Site vitrine propulsé par Astro.
  </p>
</footer>
