---
import Icon from "@components/Icons/Icon.astro";
import SectionHeader from "@components/UI/SectionHeader.astro";
import Spacer from "@components/UI/Spacer.astro";
import { resolveUrl } from "@lib/urlHelpers";
import type { FeatureSectionProps } from "@app-types/features";

const {
  eyebrow,
  title,
  description,
  features,
  display = "grid",
  theme = "light",
} = Astro.props as FeatureSectionProps;
---

<section class={`feature-section feature-section--${display} feature-section--${theme} section-container`}>
  {(eyebrow || title || description) && (
    <SectionHeader
      class="feature-section__header"
      eyebrow={eyebrow}
      title={title}
      description={description}
      headingLevel="h2"
      as="header"
    />
  )}

  <div class="feature-grid">
    {features.map((feature) => {
      const mediaType = feature.image ? "image" : feature.icon ? "icon" : null;
      const resolvedImage = feature.image
        ? {
            ...feature.image,
            src: resolveUrl(feature.image.src),
          }
        : null;
      return (
        <article class="feature-item" data-media={mediaType ?? undefined}>
          {mediaType === "image" && resolvedImage && (
            <div class="feature-media feature-media--image">
              <img src={resolvedImage.src} alt={resolvedImage.alt ?? feature.title} loading="lazy" />
            </div>
          )}
          {mediaType === "icon" && feature.icon && (
            <div class="feature-media feature-media--icon">
              <Icon type={feature.icon} />
            </div>
          )}
          <div class="feature-copy">
            <h3>{feature.title}</h3>
            {feature.description && <p set:html={feature.description} />}
          </div>
        </article>
      );
    })}
  </div>
  <Spacer size="2rem" />
</section>

<style lang="scss" is:global>
  .feature-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .feature-section--dark {
    background: var(--color-base-content);
    color: var(--color-neutral);
    padding: var(--space-5) 0;
  }

  .feature-section--accent {
    background: var(--color-secondary);
    color: var(--color-primary);
    padding: var(--space-5) 0;
  }

  .feature-grid {
    display: grid;
    gap: var(--space-4);
  }

  .feature-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-2);
  }

  .feature-section--list .feature-item {
    flex-direction: row;
    text-align: left;
    align-items: flex-start;
  }

  .feature-media {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .feature-media--icon {
    width: var(--space-6);
    height: var(--space-6);
    color: currentColor;
  }

  .feature-media--icon :global(svg) {
    width: 100%;
    height: 100%;
  }

  .feature-media--image {
    width: 100%;
    max-width: 200px;
  }

  .feature-media--image img {
    width: 100%;
    display: block;
    border-radius: var(--radius-lg, 1.25rem);
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.16);
  }

  .feature-copy {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .feature-copy h3 {
    margin: 0;
    font-size: var(--step-1);
    font-weight: 600;
  }

  .feature-copy p {
    margin: 0;
    color: var(--color-neutral-content);
    font-size: var(--step--1);
    line-height: 1.6;
  }

  @media (min-width: 768px) {
    .feature-grid {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .feature-section--list .feature-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
