---
import Icon from "@components/Icons/Icon.astro";
import type { IconProps } from "@components/Icons/icon";
import { resolveUrl, isExternalUrl } from "@lib/urlHelpers";
import styles from "./ctaDownload.module.scss";

interface CallToAction {
  label: string;
  href: string;
  icon?: IconProps["type"];
}

interface Props {
  eyebrow?: string;
  title: string;
  description?: string;
  note?: string;
  file: CallToAction;
  downloadName?: string;
}

const { eyebrow, title, description, note, file, downloadName } =
  Astro.props as Props;

const resolvedHref = resolveUrl(file.href);
const externalLink = isExternalUrl(file.href);
const sanitizedHref = file.href?.split("#")[0]?.split("?")[0] ?? file.href;
const derivedDownloadName = downloadName ?? sanitizedHref.split("/").filter(Boolean).pop();
const downloadAttr = !externalLink ? derivedDownloadName ?? "" : undefined;
---

<section class={`${styles.downloadCta} section-container`}>
  <div class={styles.shell}>
    {eyebrow && <p class={styles.eyebrow}>{eyebrow}</p>}
    <div class={styles.content}>
      <div class={styles.text}>
        <h2>{title}</h2>
        {description && <p class={styles.description} set:html={description} />}
        {note && <p class={styles.note} set:html={note} />}
      </div>
      <a
        class={styles.action}
        href={resolvedHref}
        target={externalLink ? "_blank" : undefined}
        rel={externalLink ? "noopener noreferrer" : undefined}
        download={downloadAttr}
      >
        {file.icon && (
          <span class={styles.actionIcon} aria-hidden="true">
            <Icon type={file.icon} size={32} />
          </span>
        )}
        <span class={styles.actionLabel}>{file.label}</span>
      </a>
    </div>
  </div>
</section>
