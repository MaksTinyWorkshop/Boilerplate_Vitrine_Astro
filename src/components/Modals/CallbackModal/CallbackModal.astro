---
import { DEFAULT_LOCALE, type Locale } from "@lib/i18n/locales";
import type { SiteConfig } from "@lib/siteData";
import { getSiteConfig } from "@lib/siteData";
import { resolveUrl } from "@lib/urlHelpers";
import styles from "./callbackModal.module.scss";

interface CallbackModalProps {
  site?: SiteConfig;
  locale?: Locale;
}

const { site, locale = DEFAULT_LOCALE } = Astro.props as CallbackModalProps;

const siteContent = site ?? getSiteConfig(locale);
const primaryLogo = siteContent.brand.logos[0];
const logoSrc = primaryLogo ? resolveUrl(primaryLogo.src) : "";
const callbackConfig = siteContent.interactions.callback;
const nameField = callbackConfig.fields.name;
const phoneField = callbackConfig.fields.phone;
const nameRequired = nameField.required ?? true;
const phoneRequired = phoneField.required ?? true;
const namePlaceholder = nameField.placeholder ?? nameField.label;
const phonePlaceholder = phoneField.placeholder ?? phoneField.label;
const closeLabel =
  siteContent.language === "en"
    ? "Close the call request modal"
    : "Fermer la demande de rappel";
---

<div
  class={styles.modalBackdrop}
  data-callback-modal-root
  data-modal-backdrop
  data-open="false"
  aria-hidden="true"
>
  <div
    class={styles.modal}
    role="dialog"
    aria-modal="true"
    aria-labelledby="callback-modal-title"
  >
    <button
      type="button"
      class={styles.closeButton}
      data-modal-close
      aria-label={closeLabel}
    >
      Ã—
    </button>

    <div class={styles.modalHeader}>
      {
        logoSrc && (
          <img
            src={logoSrc}
            alt={primaryLogo?.alt ?? siteContent.brand.name}
          />
        )
      }
    </div>

    <h2 id="callback-modal-title" class={styles.modalTitle}>
      {callbackConfig.title}
    </h2>

    <form class={styles.form} data-modal-form>
      <label class={styles.visuallyHidden} for={nameField.id}>
        {nameField.label}
      </label>
      <input
        id={nameField.id}
        name="name"
        type={nameField.type ?? "text"}
        required={nameRequired}
        placeholder={`${namePlaceholder}${nameRequired ? "*" : ""}`}
      />

      <label class={styles.visuallyHidden} for={phoneField.id}>
        {phoneField.label}
      </label>
      <input
        id={phoneField.id}
        name="phone"
        type={phoneField.type ?? "tel"}
        required={phoneRequired}
        pattern={phoneField.pattern}
        placeholder={`${phonePlaceholder}${phoneRequired ? "*" : ""}`}
      />

      <button class={styles.submitButton} type="submit">
        <span aria-hidden="true" class={styles.icon}>
          <svg viewBox="0 0 24 24" role="img" focusable="false">
            <path
              fill="currentColor"
              d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1-.26 11.36 11.36 0 0 0 3.56.57 1 1 0 0 1 1 1v3.57a1 1 0 0 1-1 1 17 17 0 0 1-17-17 1 1 0 0 1 1-1H7a1 1 0 0 1 1 1 11.4 11.4 0 0 0 .57 3.56 1 1 0 0 1-.26 1z"
            ></path>
          </svg>
        </span>
        {callbackConfig.submitLabel}
      </button>
    </form>

    <p class={styles.successMessage} data-modal-success hidden>
      {callbackConfig.successMessage}
    </p>

    <p class={styles.errorMessage} data-modal-error hidden>
      {callbackConfig.errorMessage}
    </p>
  </div>
</div>

<script src="./callbackModal.client.ts"></script>
