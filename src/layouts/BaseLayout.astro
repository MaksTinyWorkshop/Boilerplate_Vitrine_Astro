---
import Seo from "@components/SEO/Seo.astro";
import Navbar from "@components/UI/Navbar/Navbar.astro";
import CallbackModal from "@components/Modals/CallbackModal/CallbackModal.astro";
import SiteFooter from "@components/UI/Footer/SiteFooter.astro";
import type { BaseLayoutProps } from "@app-types/layout";
import { getSiteConfig, type SiteConfig } from "@lib/siteData";
import { DEFAULT_LOCALE } from "@lib/i18n/locales";

const {
  title,
  description,
  seo,
  lang,
  locale: localeProp,
  site,
  themeMode: providedThemeMode,
  alternates = [],
} = Astro.props as BaseLayoutProps;

const locale =
  localeProp ??
  lang ??
  site?.language ??
  DEFAULT_LOCALE;

const siteContent: SiteConfig = site ?? getSiteConfig(locale);

const descriptionValue =
  description ??
  siteContent.brand.tagline ??
  "Site vitrine moderne pour pr√©senter vos services.";

const themeConfig = siteContent.ui;
const availableThemes = themeConfig.themes;
const defaultThemeMode = themeConfig.defaultTheme ?? "light";
const initialThemeMode = providedThemeMode ?? defaultThemeMode;
const initialThemeName =
  availableThemes[initialThemeMode] ??
  availableThemes[defaultThemeMode] ??
  "mindleaf";
const seoProps = {
  ...seo,
  title: seo?.title ?? title,
  description: seo?.description ?? descriptionValue,
  site: siteContent,
  locale,
  alternates,
};
---

<!doctype html>
<html lang={locale} data-theme={initialThemeName} data-theme-mode={initialThemeMode}>
  <head>
    <base href={import.meta.env.BASE_URL} />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <Seo {...seoProps} />
    <script is:inline>
      {`window.__initialThemeConfig = ${JSON.stringify({
        defaultTheme: themeConfig.defaultTheme,
        themes: themeConfig.themes,
      })};`}
    </script>
    <script type="module" is:inline>
      {`import "@components/UI/ThemeToggle/themeRuntime.ts";`}
    </script>
  </head>
  <body>
    <Navbar site={siteContent} locale={locale} alternates={alternates} />
    <main>
      <slot />
    </main>
    <SiteFooter site={siteContent} locale={locale} />
    <CallbackModal site={siteContent} locale={locale} />
  </body>
</html>

<style lang="scss" is:global>
  @use "webcoreui/styles" as *;
  @include setup(
    (
      fontRegular: "/fonts/Montserrat.ttf",
      fontBold: "/fonts/Montserrat.ttf",
      theme: "mindleaf",
    )
  );

  html,
  body {
    min-height: 100%;
  }

  body {
    display: flex;
    flex-direction: column;
  }

  main {
    flex: 1 0 auto;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(fontBold), serif;
    text-align: center;
  }
</style>
